<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="layui-row layui-col-space15">
        <!--系统数据-->
        <div class="layui-col-md6">
          <div class="layui-card data-card">
            <div class="layui-card-header">系统录入数据</div>
            <div class="layui-card-body">
              <div class="layui-carousel layadmin-carousel layadmin-backlog">
                <div carousel-item>
                  <ul class="layui-row layui-col-space10">
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>接入学校</h3>
                        <p><cite>108</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>配送公司</h3>
                        <p><cite>12</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>划分片区</h3>
                        <p><cite>33</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>食材种类</h3>
                        <p><cite>29</cite></p>
                      </a>
                    </li>
                  </ul>
                  <!--
                                    <ul class="layui-row layui-col-space10">
                                      <li class="layui-col-xs6">
                                        <a lay-href="" class="layadmin-backlog-body">
                                          <h3>待审友情链接</h3>
                                          <p><cite style="color: #FF5722;">5</cite></p>
                                        </a>
                                      </li>
                                    </ul>
                  -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--实时数据-->
        <div class="layui-col-md6">
          <div class="layui-card">
            <div class="layui-card-header">实时数据总览</div>
            <div class="layui-card-body">
              <div class="layui-carousel layadmin-carousel layadmin-backlog">
                <div carousel-item>
                  <ul class="layui-row layui-col-space10">
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>待审订单</h3>
                        <p><cite>8</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>今日总出库</h3>
                        <p><cite>12121.32</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>今日总入库</h3>
                        <p><cite>13234.55</cite></p>
                      </a>
                    </li>
                    <li class="layui-col-xs6">
                      <a lay-href="" class="layadmin-backlog-body">
                        <h3>今日总库存</h3>
                        <p><cite>342211.22</cite></p>
                      </a>
                    </li>
                  </ul>
                  <!--
                                    <ul class="layui-row layui-col-space10">
                                      <li class="layui-col-xs6">
                                        <a lay-href="" class="layadmin-backlog-body">
                                          <h3>待审友情链接</h3>
                                          <p><cite style="color: #FF5722;">5</cite></p>
                                        </a>
                                      </li>
                                    </ul>
                  -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--数据可视化-->
        <div class="layui-col-md12">
          <div class="layui-card fullh">
            <div class="layui-card-header tab-title">可视化分析</div>
            <div class="layui-card-body chart-box">
              <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade"
                   lay-filter="LAY-index-dataview" style="overflow: visible">
                <div carousel-item id="LAY-index-dataview" style="overflow: visible">
                  <div class="tc"><i
                    class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop layadmin-loading"></i>
                  </div>
                  <!--<div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>-->
                  <!--<div></div>-->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-card">
        <div class="layui-card-header">实时对比分析</div>
        <div class="layui-card-body layadmin-takerates">
          <div class="layui-progress" lay-showPercent="yes">
            <h3>出库（日同比 5.89% <span class="layui-edge layui-edge-top" lay-tips="增长" lay-offset="-10"
                                   style="border-bottom-color: #5fb878;"></span>）</h3>
            <div class="layui-progress-bar" lay-percent="5.89%"></div>
          </div>
          <div class="layui-progress" lay-showPercent="yes">
            <h3>入库（日同比 2.22% <span class="layui-edge layui-edge-bottom" lay-tips="下降" lay-offset="-10"
                                   style="border-top-color: #ff5722;"></span>）</h3>
            <div class="layui-progress-bar layui-bg-red" lay-percent="2.22%"></div>
          </div>
          <div class="layui-progress" lay-showPercent="yes">
            <h3>库存（日同比 3.67% <span class="layui-edge layui-edge-bottom" lay-tips="下降" lay-offset="-10"
                                   style="border-top-color: #ff5722;"></span>）</h3>
            <div class="layui-progress-bar layui-bg-red" lay-percent="3.67%"></div>
          </div>
        </div>
      </div>
      <div class="layui-card fullh">
        <div class="layui-tab layui-tab-brief layadmin-latestData">
          <ul class="layui-tab-title tab-title">
            <li class="layui-this">学校总库存</li>
            <!--<li></li>-->
          </ul>
          <div class="layui-tab-content overh">
            <div class="layui-tab-item layui-show">
              <table id="LAY-index-schoolInventory"></table>
            </div>
            <!--<div class="layui-tab-item">
              <table id="LAY-index-topCard"></table>
            </div>-->
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<script>
  layui.use(['admin', 'echarts', 'carousel', 'table'], function () {
    var $ = layui.$
      , admin = layui.admin
      , carousel = layui.carousel
      , element = layui.element
      , device = layui.device()
      , table = layui.table
      , echarts = layui.echarts;

    $('.fullh').height(admin.getRightAvailableHeight()-$('.data-card').height() - 15);
    $('.chart-box').height($('.fullh').height() - $('.tab-title').height() - 20);

    // 进度条占比
    element.render('progress');

    // 区块轮播切换
    $('.layadmin-carousel').each(function () {
      var othis = $(this);
      carousel.render({
        elem: this
        , width: '100%'
        , arrow: 'none'
        , interval: othis.data('interval')
        , autoplay: othis.data('autoplay') === true
        , trigger: (device.ios || device.android) ? 'click' : 'hover'
        , anim: othis.data('anim')
      });
    });

    // 可视化
    var echartsApp = []
      , options = []
      , elemDataView = $('#LAY-index-dataview').children('div')
      , renderDataView = function (index) {
      echartsApp[index] = echarts.init(elemDataView[index], layui.echartsTheme);
      echartsApp[index].resize({
        height: $('.fullh').height() - $('.tab-title').height() - 30
      });
      echartsApp[index].setOption(options[index]);
      window.onresize = echartsApp[index].resize;
    };
    // 请求数据，成功后执行渲染
    $.ajax({
      type: 'get',
      url: 'https://www.easy-mock.com/mock/5aefbefe474c537b3e077081/nutritious/crkfx',
      dataType: 'json',
      data: '',
      beforeSend: function () {
      },
      complete: function () {
      },
      success: function (result) {
        if (result.success) {
          options = [{
            /*title: {
              text: '今日流量趋势',
              x: 'center',
              textStyle: {
                fontSize: 14
              }
            },*/
            grid: {
              left: '0',
              right: '0',
              bottom: '1%',
              containLabel: true
            },
            tooltip: {
              trigger: 'axis'
            },
            legend: {
              data: result.data.map(function (item) {
                return item.name;
              })
            },
            xAxis: [{
              type: 'category',
              boundaryGap: false,
              data: result.xData
            }],
            yAxis: [
              {
                type: 'value',
                name: '元',
                axisLabel: {
                  formatter: '{value}'
                }
              },
              {
                type: 'value',
                name: '元',
                axisLabel: {
                  formatter: '{value}'
                }
              }
            ],
            dataZoom: [
              {
                type: 'slider',
                show: true,
                xAxisIndex: [0],
                start: 30,
                end: 100
              }
            ],
            series: [
              {
                name: result.data[0].name,
                type: 'line',
                smooth: true,
                itemStyle: {normal: {areaStyle: {type: 'default'}}},
                data: result.data[0].value
              },
              {
                name: result.data[1].name,
                type: 'line',
                smooth: true,
                itemStyle: {normal: {areaStyle: {type: 'default'}}},
                data: result.data[1].value
              },
              {
                yAxisIndex: 1,
                name: result.data[2].name,
                type: 'line',
                label: {
                  normal: {
                    show: false,
                    position: 'top'
                  }
                },
                smooth: true,
                itemStyle: {normal: {areaStyle: {type: 'default'}}},
                data: result.data[2].value
              }
            ],
          }, {
            title: {
              text: '今日流量趋势',
              x: 'center',
              textStyle: {
                fontSize: 14
              }
            },
            tooltip: {
              trigger: 'axis'
            },
            legend: {
              data: ['', '']
            },
            xAxis: [{
              type: 'category',
              boundaryGap: false,
              data: ['06:00', '06:30', '07:00', '07:30', '08:00', '08:30', '09:00', '09:30', '10:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00', '23:30']
            }],
            yAxis: [{
              type: 'value'
            }],
            series: [{
              name: 'PV',
              type: 'line',
              smooth: true,
              itemStyle: {normal: {areaStyle: {type: 'default'}}},
              data: [111, 222, 333, 444, 555, 666, 3333, 33333, 55555, 66666, 33333, 3333, 6666, 11888, 26666, 38888, 56666, 42222, 39999, 28888, 17777, 9666, 6555, 5555, 3333, 2222, 3111, 6999, 5888, 2777, 1666, 999, 888, 777]
            }, {
              name: 'UV',
              type: 'line',
              smooth: true,
              itemStyle: {normal: {areaStyle: {type: 'default'}}},
              data: [11, 22, 33, 44, 55, 66, 333, 3333, 5555, 12666, 3333, 333, 666, 1188, 2666, 3888, 6666, 4222, 3999, 2888, 1777, 966, 655, 555, 333, 222, 311, 699, 588, 277, 166, 99, 88, 77]
            }]
          }, {}];
          //没找到DOM，终止执行
          if (!elemDataView[0]) return;
          renderDataView(0);
        }
      }
    });

    //监听数据概览轮播
    var carouselIndex = 0;
    carousel.on('change(LAY-index-dataview)', function (obj) {
      renderDataView(carouselIndex = obj.index);
    });

    //监听侧边伸缩
    layui.admin.on('side', function () {
      setTimeout(function () {
        renderDataView(carouselIndex);
      }, 300);
    });

    //监听路由
    layui.admin.on('hash(tab)', function () {
      layui.router().path.join('') || renderDataView(carouselIndex);
    });

    //学校库存表格
    table.render({
      elem: '#LAY-index-schoolInventory'
      , url: admin.baseUrl + "/schoolInventory" //模拟接口
      , method: 'post'
      , height: $('.fullh').height() - $('.tab-title').height() - 30
      , page: false
      , cols: [[
        {type: 'numbers', title: '<span style="">NO.</span>', fixed: 'left'}
        , {field: 'name', title: '学校名称'}
        , {field: 'amount', title: '总库存量/元', sort: true, width: 180, align: 'right'}
      ]]
    });
  });
</script>

