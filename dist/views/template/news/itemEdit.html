<title>分类栏目</title>
<style>
</style>

<div class="">
  <form class="layui-form layui-form-pane" lay-filter="editForm">
    <!--id-->
    <input type="hidden" name="id">
    <!--栏目名称-->
    <div class="layui-form-item">
      <label class="layui-form-label">文章标题</label>
      <div class="layui-input-block">
        <input type="text" name="name" lay-verify="required" autocomplete="off" placeholder="请输入栏目名称"
               class="layui-input">
      </div>
    </div>
    <!--所属商户、排序、锁定-->
    <div class="layui-form-item layui-row layui-col-space20" style="margin-bottom: 5px">
      <div class="layui-col-xs4">
        <label class="layui-form-label layui-tip-label">所属商户</label>
        <div class="layui-input-block">
          <select name="crmMerchant" lay-filter="sex">
            <option value="">--请选择所属商户--</option>
            <option value="1">商户一</option>
            <option value="2">商户二</option>
            <option value="3">商户三</option>
          </select>
        </div>
      </div>
      <div class="layui-col-xs4">
        <label class="layui-form-label layui-tip-label">权值排序</label>
        <div class="layui-input-block">
          <input type="number" name="sort" lay-verify="required" placeholder="请输入权值排序" autocomplete="off"
                 class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs4">
        <label class="layui-form-label layui-tip-label">禁用栏目</label>
        <div class="layui-input-block b-e6">
          <input type="checkbox" name="disabled" lay-skin="switch" lay-text="禁用|不禁用" title="锁定" lay-filter="disabled">
        </div>
      </div>
    </div>
    <!--描述信息-->
    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">文章摘要</label>
      <div class="layui-input-block">
        <textarea name="summary" placeholder="请输入文章主题摘要" class="layui-textarea"></textarea>
      </div>
    </div>
    <!--详情-->
    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">消息编辑</label>
      <div class="layui-input-block">
        <textarea id="detail" name="detail" placeholder="请输入文章内容" class="layui-textarea"></textarea>
      </div>
    </div>
    <div class="layui-form-item mb0">
      <div class="layui-footer">
        <button type="button" class="layui-btn fr" lay-submit="" lay-filter="form-smt">立即提交</button>
        <button type="button" class="layui-btn layui-btn-primary fl ml0" lay-filter="form-undo">撤销操作</button>
      </div>
    </div>
  </form>
</div>

<script>
  layui.use(['admin', 'form', 'table', 'layedit'], function () {
    var $ = layui.$
            , admin = layui.admin
            , layer = layui.layer
            , table = layui.table
            , form = layui.form
            , layedit = layui.layedit;

    // 重新渲染表单所有控件
    form.render(null, 'editForm');

    // 建立编辑器
    var layeditInst = layedit.build('detail', {
      height: 235
      ,
      uploadImage: {
        url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/postSuccessImg',
        type: 'post'
      }
      ,
      tool: [
        'strong' //加粗
        , 'italic' //斜体
        , 'underline' //下划线
        , 'del' //删除线

        , '|' //分割线

        , 'left' //左对齐
        , 'center' //居中对齐
        , 'right' //右对齐
        , 'link' //超链接
        , 'unlink' //清除链接
        , 'face' //表情
        , 'image' //插入图片
        , 'help' //帮助
      ]
    });

    // 监听提交
    form.on('submit(form-smt)', function (data) {
      data.field.detail = layedit.getContent(layeditInst);
      $.ajax({
        //contentType: 'application/json; charset=utf-8',
        type: 'post',
        url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/columnTable',
        data: JSON.stringify(data.field),
        dataType: 'json',
        beforeSend: function () {
          this.loadingIdx = admin.loading();
        },
        complete: function () {
          layer.close(this.loadingIdx);
        },
        success: function (result) {
          if(result.code == 0){
            table.reload('columnTable', {
              data: result.data,
              where: {} // 请求额外参数（注意：这里面的参数可任意定义）
            });
            layer.msg('数据编辑成功', {icon:1})
          };
          if(admin.popup.editLayer) layer.close(admin.popup.editLayer);
          if(admin.popup.addLayer) layer.close(admin.popup.addLayer);
        },
        error: function (error) {
          layer.msg('请求出错啦', {icon: 2,anim:6});
        },
      });
      return false;
    });
  });
</script>