<title></title>
<style>
  .layui-badge {
    margin-right: 5px
  }
  .logo{width: 60px;height: 60px;border-radius: 100%;cursor: pointer}
</style>
<!--可在form上添加layui-form-pane类来改变表单风格-->
<form class="layui-form layui-form-pane" lay-filter="info-form">
  
  <div class="tc">
    <img title="点击上传头像" class="logo" src="http://www.yyweishi.com/uploads/allimg/140323/010H92234-16.jpg" alt="">
    <p class="mt5 mb5 account">贵州万创宏达科技有限责任公司</p>
  </div>
  <!--信息表单折叠面板-->
  <div class="layui-collapse" lay-filter="info-panel">
    <!--单位信息-->
    <div class="layui-colla-item">
      <h2 class="layui-colla-title">公司详细信息</h2>
      <div class="layui-colla-content layui-show" style="padding: 20px 15px">
        <div class="layui-row layui-col-space20">
          <div class="layui-col-xs6">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">公司全称</label>
              <div class="layui-input-block">
                <input type="text" name="name" lay-verify="" autocomplete="off" placeholder="公司全称"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-xs6">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">办公电话</label>
              <div class="layui-input-block">
                <input type="text" name="telephone" lay-verify="" autocomplete="off" placeholder="公司办公电话"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-xs6">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">公司法人</label>
              <div class="layui-input-block">
                <input type="text" name="legalPerson" lay-verify="" autocomplete="off" placeholder="公司法人代表"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-xs6">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">公司邮箱</label>
              <div class="layui-input-block">
                <input type="text" name="email" lay-verify="" autocomplete="off" placeholder="公司邮箱"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-xs12">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">公司地址</label>
              <div class="layui-input-block">
                <input type="text" name="address" lay-verify="" autocomplete="off" placeholder="公司所在地址"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-xs12">
            <div class="layui-form-item mb0">
              <label class="layui-form-label">公司备注</label>
              <div class="layui-input-block">
                <input type="text" name="desc" lay-verify="" autocomplete="off" placeholder="备注信息"
                       class="layui-input">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--提交-->
  <div class="layui-form-item mt20">
    <button id="givupBtn" style="width: 48%;float: left;" type="button"
            class="layui-btn layui-btn-danger layui-btn-fluid" lay-filter="info-undo">撤销修改
    </button>
    <button style="width: 48%;float: right;" type="button" class="layui-btn layui-btn-fluid" lay-submit=""
            lay-filter="info-smt">确认保存
    </button>
  </div>
</form>

<script>
  layui.use(['admin', 'form', 'formSelects', 'table', 'upload'], function () {
    var $ = layui.$
      , admin = layui.admin
      , element = layui.element
      , layer = layui.layer
      , table = layui.table
      , upload = layui.upload
      , form = layui.form;

    element.render('collapse');

    form.render();

    // 头像图片上传
    var uploadInst = upload.render({
      elem: '.avatar'
      ,url: admin.baseUrl + '/postSuccess'
      ,before: function(obj){
        //预读本地文件示例，不支持ie8
        obj.preview(function(index, file, result){
          $('.avatar').attr('src', result); //图片链接（base64）
        });
      }
      ,done: function(res){
        //如果上传失败
        if(res.code > 0){
          return layer.msg('上传失败');
        }
        //上传成功
      }
      ,error: function(){
        /* 失败状态，并实现重传
        demoText.find('.demo-reload').on('click', function(){
          uploadInst.upload();
        });*/
      }
    });

    // 自定义验证规则
    form.verify({
      title: function (value) {
        if (value.length < 2) {
          return '昵称不得少于2个字符';
        }
      }
    });

    // 监听提交(根据lay-filter值来监听提交，便于保存操作和新增操作的提交公用一个方法)，但是需要判断是新增模式还是修改模式（根据点击按钮是否有data-id值来确定，有的话是编辑模式，无则是新增模式）
    form.on('submit(info-smt)', function (data) {
      $.ajax({
        type: 'post',
        url: admin.baseUrl + '/postSuccess',
        data: data.field,
        dataType: 'json',
        beforeSend: function () {
          this.loading = admin.loading();
        },
        complete: function () {
          layer.close(this.loading);
        },
        success: function (result) {
          $.ajax({
            type: 'post',
            url: admin.baseUrl + '/role',
            data: data.field,
            dataType: 'json',
            beforeSend: function () {
              this.loading = admin.loading();
            },
            complete: function () {
              layer.close(this.loading);
            },
            success: function (result) {
              if (result.code == 0) {
                layer.close(admin.popup.infoLayer);
                table.reload('userTable', {
                  data: result.data,
                  where: {} // 请求额外参数（注意：这里面的参数可任意定义）
                });
              }
            },
            error: function (error) {
              layer.msg('请求出错啦', {icon: 2});
            },
          });
          layer.msg('编辑成功', {icon: 1});
          layer.close(admin.popup.operateLayer);
          // formReset();
        },
        error: function (error) {
          layer.msg('请求出错啦', {icon: 2});
        },
      });
    });

    // 删除分类事件（首先获取已选分类id值，然后判断已选分类是否是系统默认分类，是的话不允许继续删除操作，不是的话友情提示下是否确认删除，以及删除后的操作提示，用户依然确认删除的话就执行ajax请求提交删除项）
    $('form').on('click', '#givupBtn', function () {
      var that = this;
      layer.msg('撤销编辑操作，还原至初始状态')
    });

  });
</script>