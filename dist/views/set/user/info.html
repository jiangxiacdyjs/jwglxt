
<title>设置我的资料</title>

<style>
  .layui-badge {
    margin-right: 5px
  }
  .avatar{width: 60px;height: 60px;border-radius: 100%;cursor: pointer}
</style>
<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-card-header">用户信息管理</div>
    <div class="layui-card-body">

      <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title">
          <li class="layui-this">用户信息</li>
          <li>单位信息</li>
          <li>账户信息</li>
        </ul>
        <div class="layui-tab-content">
          <!--个人信息-->
          <div class="layui-tab-item layui-show">
            <!--可在form上添加layui-form-pane类来改变表单风格-->
            <form class="layui-form layui-form-pane" lay-filter="my-info-form">
              <div class="layui-row mt20" style="line-height: 25px">
                <img title="点击上传头像" class="avatar fl mr10" src="http://www.yyweishi.com/uploads/allimg/140323/010H92234-16.jpg" alt="">
                <div class="fl mr10">
                  <p class="" style="padding-top: 5px"><span>会飞的猪</span><span class="lgray">（account）</span></p>
                  <p class="lgray" style="padding-bottom: 5px">上次登录：2018-05-20 22:18:35</p>
                </div>
                <div class="fl" style="line-height: 48px">
                  <input type="radio" name="sex" value="男" title="男" checked>
                  <input type="radio" name="sex" value="女" title="女">
                </div>
              </div>
              <div class="layui-row layui-col-space20 mt20">
                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">昵称</label>
                    <div class="layui-input-block">
                      <input value="会飞的猪" type="text" name="nickname" lay-verify="title" autocomplete="off" placeholder="请输入用户昵称"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">年龄</label>
                    <div class="layui-input-block">
                      <input value="29" type="number" name="age" lay-verify="required" autocomplete="off" placeholder="请输入您的年龄"
                             class="layui-input">
                    </div>
                  </div>
                </div>

                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">手机号码</label>
                    <div class="layui-input-block">
                      <input value="13838383388" type="number" name="phone" lay-verify="phone" autocomplete="off" placeholder="请输入常用手机号"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">常用邮箱</label>
                    <div class="layui-input-block">
                      <input value="freshzxf@gmail.com" type="text" name="email" lay-verify="email" autocomplete="off" placeholder="请输入常用邮箱"
                             class="layui-input">
                    </div>
                  </div>
                </div>

                <div class="layui-col-xs12">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">签名</label>
                    <div class="layui-input-block">
                      <input value="心之所向，素履以往，生如逆旅，一苇以航。”" type="text" name="desc" class="layui-input" placeholder="菩提本无树，明镜亦非台，本来无一物，何处惹尘埃。">
                    </div>
                  </div>
                </div>
              </div>
              <!--提交-->
              <div class="layui-form-item mt20">
                <button style="width: 48%;float: left;" type="button"
                        class="giveUpBtn layui-btn layui-btn-danger layui-btn-fluid">撤销修改
                </button>
                <button style="width: 48%;float: right;" type="button" class="layui-btn layui-btn-fluid" lay-submit=""
                        lay-filter="my-info-smt">确认保存
                </button>
              </div>
            </form>
          </div>
          <!--所在单位信息-->
          <div class="layui-tab-item">
            <form class="layui-form layui-form-pane" lay-filter="group-info-form">
              <div class="layui-row layui-col-space20">
                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">单位名称</label>
                    <div class="layui-input-block">
                      <input type="text" name="group" lay-verify="" autocomplete="off" placeholder="所在单位全称"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs6">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">办公电话</label>
                    <div class="layui-input-block">
                      <input type="text" name="gphone" lay-verify="" autocomplete="off" placeholder="所在单位办公电话"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs12">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">单位地址</label>
                    <div class="layui-input-block">
                      <input type="text" name="address" lay-verify="" autocomplete="off" placeholder="所在单位地址"
                             class="layui-input">
                    </div>
                  </div>
                </div>
              </div>
              <!--提交-->
              <div class="layui-form-item mt20">
                <button style="width: 48%;float: left;" type="button"
                        class="giveUpBtn layui-btn layui-btn-danger layui-btn-fluid">撤销修改
                </button>
                <button style="width: 48%;float: right;" type="button" class="layui-btn layui-btn-fluid" lay-submit=""
                        lay-filter="group-info-smt">确认保存
                </button>
              </div>
            </form>
          </div>
          <!--账户信息-->
          <div class="layui-tab-item">
            <form class="layui-form layui-form-pane" lay-filter="account-info-form">
              <div class="layui-row layui-col-space20">
                <div class="layui-col-xs12">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">原密码</label>
                    <div class="layui-input-block">
                      <input type="password" name="pwd" lay-verify="required" autocomplete="off" placeholder="请输入原密码"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs12">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">新密码</label>
                    <div class="layui-input-block">
                      <input type="password" name="newpwd" lay-verify="required" autocomplete="off" placeholder="请输入新密码"
                             class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-col-xs12">
                  <div class="layui-form-item mb0">
                    <label class="layui-form-label">确认新密码</label>
                    <div class="layui-input-block">
                      <input type="password" name="renewpwd" lay-verify="renewpwd" autocomplete="off" placeholder="请确认信密码"
                             class="layui-input">
                    </div>
                  </div>
                </div>
              </div>
              <!--提交-->
              <div class="layui-form-item mt20">
                <button style="width: 48%;float: left;" type="button"
                        class="giveUpBtn layui-btn layui-btn-danger layui-btn-fluid">撤销修改
                </button>
                <button style="width: 48%;float: right;" type="button" class="layui-btn layui-btn-fluid" lay-submit=""
                        lay-filter="account-info-smt">确认保存
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
// layui.use('set', layui.factory('set'));
layui.use(['admin', 'form', 'layer', 'element', 'upload'], function () {
  var $ = layui.$
    , admin = layui.admin
    , element = layui.element
    , layer = layui.layer
    , upload = layui.upload
    , form = layui.form;

  form.render();

  // 头像图片上传
  var uploadInst = upload.render({
    elem: '.avatar'
    ,url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/postSuccess'
    ,before: function(obj){
      var $triggerEle = $(this.item);
      //预读本地文件示例，不支持ie8
      obj.preview(function(index, file, result){
        $triggerEle.attr('src', result); //图片链接（base64）
      });
    }
    ,done: function(res){
      //如果上传失败
      if(res.code > 0){
        return layer.msg('上传失败');
      }
      //上传成功
    }
    ,error: function(){
      /* 失败状态，并实现重传
      demoText.find('.demo-reload').on('click', function(){
        uploadInst.upload();
      });*/
    }
  });

  // 自定义验证规则
  form.verify({
    title: function (value) {
      if (value.length < 2) {
        return '昵称不得少于2个字符';
      }
    },
    renewpwd:function (value) {
      if(!value.length){
        return "请确认密码"
      }else if( value !== $('form[lay-filter="account-info-form"]').find(':input[name="newpwd"]').val() ){
        return "两次输入密码不一致"
      }
    }
  });

  // 我的信息表单提交
  form.on('submit(my-info-smt)', function (data) {
    $.ajax({
      type: 'post',
      url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/postSuccess',
      data: data.field,
      dataType: 'json',
      beforeSend: function () {
        this.loading = admin.loading();
      },
      complete: function () {
        layer.close(this.loading);
      },
      success: function (result) {
        layer.msg('编辑成功', {icon: 1});
        // formReset();
      },
      error: function (error) {
        layer.msg('请求出错啦', {icon: 2});
      },
    });
  });
  // 所在单位表单提交
  form.on('submit(group-info-smt)', function (data) {
    $.ajax({
      type: 'post',
      url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/postSuccess',
      data: data.field,
      dataType: 'json',
      beforeSend: function () {
        this.loading = admin.loading();
      },
      complete: function () {
        layer.close(this.loading);
      },
      success: function (result) {
        layer.msg('编辑成功', {icon: 1});
        // formReset();
      },
      error: function (error) {
        layer.msg('请求出错啦', {icon: 2});
      },
    });
  });
  // 密码修改表单提交
  form.on('submit(account-info-smt)', function (data) {
    $.ajax({
      type: 'post',
      url: 'https://www.easy-mock.com/mock/5af45f8ab45afc56560ae781/admin/postSuccess',
      data: data.field,
      dataType: 'json',
      beforeSend: function () {
        this.loading = admin.loading();
      },
      complete: function () {
        layer.close(this.loading);
      },
      success: function (result) {
        $('form[lay-filter="account-info-form"]').get(0).reset();
        layer.msg('编辑成功', {icon: 1});
        // formReset();
      },
      error: function (error) {
        layer.msg('请求出错啦', {icon: 2});
      },
    });
  });

  // todo:撤销标记需要恢复最近一次保存在数据库的信息
  $('form').on('click', '.giveUpBtn', function () {
    var that = this;
    layer.msg('撤销编辑操作，还原至最近一次保存状态')
  });

});

</script>