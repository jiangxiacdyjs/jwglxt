<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <!--[if lt IE 9]>
  <script type="text/javascript" src="../Public/lib/html5shiv.js"></script>
  <script type="text/javascript" src="../Public/lib/respond.min.js"></script>

  <![endif]-->
  <link href="../Public/static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css"/>
  <link href="../Public/static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css"/>
  <link href="../Public/lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" type="text/css" href="../Public/lib/jedate-6.5.0/skin/jedate.css"/>
  <link href="../Public/lib/responsiveTab/css/responsive.tabs.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" type="text/css" href="../Public/static/h-ui.admin/skin/green/skin.css" id="skin"/>
  <link rel="stylesheet" type="text/css" href="../Public/mySrc/css/style.css"/>
  <!--[if IE 6]>
  <script type="text/javascript" src="../Public/lib/DD_belatedPNG_0.0.8a-min.js"></script>
  <script>DD_belatedPNG.fix('*');</script>
  <![endif]-->
  <style>
    label.Initials {
      background-color: gray;
      color: #fff;
      display: inline-block;
      text-align: center;
      padding: 3px 10px;
      margin-right: 3px;
    }

    .fix-top {
      position: fixed;
      top: 0;
      width: 39%;
    }

    .fname {
      cursor: pointer;
      padding: 3px 10px;
      color: #fff;
      display: inline-block;
      margin-top: 10px;
      margin-right: 5px;
      -moz-user-select: none;
    }

    .fname-sc {
      background-color: #77C34F;
    }

    .fname-hc {
      background-color: #597798;
    }

    .fname-tl {
      background-color: #8192D6;
    }

    .fname-gc {
      background-color: #7E884F;
    }

    .fname-dz {
      background-color: #fdb933;
    }

    .fname-ly {
      background-color: #228fbd;
    }

    .mlr--10 {
      margin-left: -10px;
      margin-right: -10px;
    }

    .tab-content {
      margin-top: -10px !important;
    }

    .tabs-vertical-left .tabs-list li a, .tabs-vertical-right .tabs-list li a {
      width: 110px !important;
    }
  </style>
  <style>
    .title-table {
      width: 100%;
      text-align: center
    }

    .title-table td {
      width: 50%
    }

    .title-table tr:nth-of-type(2) td {
      width: 25%
    }

    /*新增input，select的特殊样式*/
    .se-input {
      width: 100px;
      cursor: pointer;
      font-weight: normal;
      border: 0;
      background-color: rgba(255, 255, 255, 0.8);
    }
    .se-input select {
      background-color: transparent;
    }
    /*新增input，select的特殊样式结束/*/

    .list-table thead tr th,.list-table td {
      display: block;
      float: left;
      box-sizing: border-box;
      width: 14.28%;
    }

    .list-table thead tr td, .list-table tbody tr td {
      display: block;
      height: 42px;
      line-height: 31px !important;
    }

    .list-table tbody {
      display: block;
      width: 100%;
      overflow-y: scroll;
    }

    .list-table tbody tr {
      display: block;
      width: 100%;
    }

    .list-table tbody td {
      box-sizing: border-box;
      width: 14.28%;
    }
  </style>
  <title>学校食材编辑上报</title>
</head>
<body>
<div class="pl-20 pr-20 pt-20 pb-20" style="box-sizing: border-box">
  <div class="row clearfix">
    <div class="col-sm-5">
      <div id="foodPanel" class="panel panel-success panerFix clearfix">
        <div class="panel-header pos-r">食材选择列表</div>
        <div class="panel-body">
          <div class="Huialert Huialert-success">
            <span>操作说明：</span><span class="c-red">双击</span>下方食材名称即可快速新增食材，新增后在右侧表格中编辑单位及数量！
          </div>
          <div class="tabs tabs-vertical-left">
            <ul id="list1" class="tabs-list">
              <li class="active">
                <a href="javascript:;" class="pos-r">
                  <span>蔬菜类</span>
                </a>
              </li>
              <li>
                <a href="javascript:;" class="pos-r">
                  <span>荤菜类</span>
                </a>
              </li>
              <li>
                <a href="javascript:;" class="pos-r">
                  <span>调料类</span>
                </a>
              </li>
              <li>
                <a href="javascript:;" class="pos-r">
                  <span>豆制类</span>
                </a>
              </li>
              <li>
                <a href="javascript:;" class="pos-r">
                  <span>干菜类</span>
                </a>
              </li>
              <li>
                <a href="javascript:;" class="pos-r">
                  <span>粮油类</span>
                </a>
              </li>
            </ul>
            <div id="foodMenu" class="tabs-container">
              <div class="tab-content" style="display:block;">
                <label class="Initials">B</label>
                <span class="fname fname-sc" data-unit="斤" data-id="1">白菜</span>
                <span class="fname fname-sc" data-unit="颗" data-id="2">白花菜</span>
                <span class="fname fname-sc" data-unit="根" data-id="3">白萝卜</span>
                <label class="Initials">C</label>
                <span class="fname fname-sc" data-unit="斤" data-id="4">菜心</span>
                <span class="fname fname-sc" data-unit="斤" data-id="5">菜豌豆</span>
                <label class="Initials" data-unit="斤">D</label>
                <span class="fname fname-sc" data-unit="斤" data-id="6">大葱</span>
                <span class="fname fname-sc" data-id="7">大芹菜</span>
                <span class="fname fname-sc" data-id="8">大蒜苗</span>
                <span class="fname fname-sc" data-id="9">冬瓜</span>
                <label class="Initials">E</label>
                <span class="fname fname-sc" data-id="10">儿菜</span>
                <label class="Initials">H</label>
                <span class="fname fname-sc" data-id="11">胡萝卜</span>
                <span class="fname fname-sc" data-id="12">黄瓜</span>
                <label class="Initials">J</label>
                <span class="fname fname-sc" data-id="13">胶瓜（水笋）</span>
                <label class="Initials">L</label>
                <span class="fname fname-sc" data-id="14">老南瓜</span>
                <span class="fname fname-sc" data-id="15">莲花菜</span>
                <label class="Initials">N</label>
                <span class="fname fname-sc" data-id="16">牛心菜</span>
                <label class="Initials">Q</label>
                <span class="fname fname-sc" data-id="17">茄子</span>
                <span class="fname fname-sc" data-id="18">青花菜</span>
                <span class="fname fname-sc" data-id="19">青辣椒</span>
                <label class="Initials">S</label>
                <span class="fname fname-sc" data-id="20">生姜</span>
                <span class="fname fname-sc" data-id="21">蒜台</span>
                <label class="Initials">W</label>
                <span class="fname fname-sc" data-id="22">豌豆米</span>
                <span class="fname fname-sc" data-id="23">莴笋</span>
                <label class="Initials">X</label>
                <span class="fname fname-sc" data-id="24">西红柿</span>
                <span class="fname fname-sc" data-id="25">香葱</span>
                <span class="fname fname-sc" data-id="26">小瓜</span>
                <span class="fname fname-sc" data-id="27">小芹菜</span>
                <label class="Initials">Y</label>
                <span class="fname fname-sc" data-id="28">洋葱</span>
                <span class="fname fname-sc" data-id="29">洋芋</span>
                <span class="fname fname-sc" data-id="30">玉米粒</span>
              </div>
              <div class="tab-content">
                <label class="Initials">J</label>
                <span class="fname fname-hc" data-id="31">鸡边腿</span>
                <span class="fname fname-hc" data-id="32">鸡蛋</span>
                <label class="Initials">N</label>
                <span class="fname fname-hc" data-id="33">牛肉</span>
                <label class="Initials">Y</label>
                <span class="fname fname-hc" data-id="34">羊肉</span>
                <label class="Initials">Z</label>
                <span class="fname fname-hc" data-id="35">猪肉</span>
              </div>
              <div class="tab-content">
                <label class="Initials">D</label>
                <span class="fname fname-tl" data-id="36">豆瓣酱</span>

                <label class="Initials">G</label>
                <span class="fname fname-tl" data-id="37">干辣椒</span>

                <label class="Initials">H</label>
                <span class="fname fname-tl" data-id="38">胡椒</span>
                <span class="fname fname-tl" data-id="39">花椒颗</span>
                <span class="fname fname-tl" data-id="40">花椒面</span>

                <label class="Initials">J</label>
                <span class="fname fname-tl" data-id="41">酱油</span>

                <label class="Initials">L</label>
                <span class="fname fname-tl" data-id="42">辣椒面</span>

                <label class="Initials">S</label>
                <span class="fname fname-tl" data-id="43">砂仁</span>
                <span class="fname fname-tl" data-id="44">食盐（250克）</span>
                <span class="fname fname-tl" data-id="45">食盐（500克）</span>

                <label class="Initials">W</label>
                <span class="fname fname-tl" data-id="46">味精</span>

                <label class="Initials">Z</label>
                <span class="fname fname-tl" data-id="47">糟辣椒</span>
              </div>
              <div class="tab-content">
                <label class="Initials">B</label>
                <span class="fname fname-dz" data-id="48">白豆腐</span>
                <label class="Initials">D</label>
                <span class="fname fname-dz" data-id="49">豆腐干</span>
                <span class="fname fname-dz" data-id="50">豆腐皮</span>
                <label class="Initials">Q</label>
                <span class="fname fname-dz" data-id="51">千张豆腐</span>
                <label class="Initials">Y</label>
                <span class="fname fname-dz" data-id="52">烟熏豆腐</span>
              </div>
              <div class="tab-content">
                <label class="Initials">C</label>
                <span class="fname fname-gc" data-id="53">炒豆</span>
                <label class="Initials">D</label>
                <span class="fname fname-gc" data-id="54">大豆米</span>
                <label class="Initials">G</label>
                <span class="fname fname-gc" data-id="55">干木耳</span>
                <span class="fname fname-gc" data-id="56">干香菇</span>
                <label class="Initials">H</label>
                <span class="fname fname-gc" data-id="57">海带</span>
                <label class="Initials">X</label>
                <span class="fname fname-gc" data-id="58">细木耳</span>
                <label class="Initials">Z</label>
                <span class="fname fname-gc" data-id="59">紫菜</span>
              </div>
              <div class="tab-content">
                <label class="Initials">C</label>
                <span class="fname fname-ly" data-id="60">菜籽油</span>
                <label class="Initials">D</label>
                <span class="fname fname-ly" data-id="61">大米</span>
                <label class="Initials">J</label>
                <span class="fname fname-ly" data-id="62">煎粉</span>
                <label class="Initials">M</label>
                <span class="fname fname-ly" data-id="63">米粉</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-7">
      <div id="listPanel" class="panel panel-success">
        <div class="panel-header">
          <!--------------新增表格内容--------------->
          <table class="title-table">
            <tr class="c-white" style="border-bottom: 1px dotted #abcfde">
              <td colspan="2" class="c-white pb-10" style="text-align: left!important;"><span>单位：</span><span>紫云县第二小学家长学校</span>
              </td>
              <td colspan="2" class="c-white pb-10" style="text-align: right!important;"><span>当前日期：</span><span
                      id="date"></span></td>
            </tr>
            <tr class="">
              <td class="c-white pt-10">
                <div class="f-l">
                  <!--新增选择餐别-->
                  <span>餐别：</span>
                  <span class="select-box p-0 se-input">
                                            <select class="select" style="height: 31px;" id="mealType">
                                                <option value="">--选择餐别--</option>
                                                <option value="1">早餐</option>
                                                <option value="2">中餐</option>
                                                <option value="3">晚餐</option>
                                            </select>
                                        </span>
                </div>

              </td>
              <td class="c-white pt-10">
                <span>起始日期：</span>
                <input type="text" id="supply_start_date" placeholder="供应起始时间"
                       class="input-text ac_input text-c se-input"
                       name="search_text" value=""
                       autocomplete="off" readonly>
              </td>
              <td class="c-white pt-10">
                <span>结束日期：</span>
                <input type="text" id="supply_end_date" placeholder="供应结束时间"
                       class="input-text ac_input text-c se-input"
                       name="search_text" value=""
                       autocomplete="off" readonly>
              </td>
              <td class="c-white pt-10">
                <div class="f-r">
                  <span>结算日期：</span>
                  <input type="text" id="settle_date" placeholder="结算年月"
                         class="input-text ac_input text-c se-input"
                         name="search_text" value=""
                         autocomplete="off" readonly>
                </div>
              </td>
            </tr>
          </table>
          <!--------------/新增表格内容结束--------------->
        </div>
        <div class="panel-body p-0">
          <table class="table table-border table-bordered table-bg table-hover border-0 list-table clearfix"
                 id="table">
            <thead>
            <tr class="text-c" data-tabullet-map="id">
              <th data-tabullet-map="_index" data-tabullet-readonly="true">编号</th>
              <th data-tabullet-map="name">食材名称</th>
              <th data-tabullet-map="unit">食材单位</th>
              <th data-tabullet-map="amount">食材数量</th>
              <th data-tabullet-map="mark">备注信息</th>
              <th data-tabullet-type="edit">编辑</th>
              <th data-tabullet-type="delete">删除</th>
            </tr>
            </thead>
          </table>
        </div>
      </div>
      <!--<p class="text-c">
        <input class="btn btn-primary radius mt-30" type="submit" value="确认上报">
      </p>-->
    </div>
  </div>
</div>

<script type="text/javascript" src="../Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="../Public/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../Public/lib/responsiveTab/js/responsive.tabs.js"></script>
<script type="text/javascript" src="../Public/lib/jedate-6.5.0/dist/jedate.min.js"></script>
<script type="text/javascript" src="../Public/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../Public/lib/jquery.tabullet/js/tabullet.js"></script>
<script type="text/javascript" src="../Public/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="../Public/static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="../Public/mySrc/js/common.js"></script>
<script>

  //获取当前浏览器滚动条的宽度，原理是设置一个不可见的div，查看设置scorll前后的宽度差
  function getScrollWidth() {
    var noScroll, scroll, oDiv = document.createElement("DIV");
    oDiv.style.cssText = "position:absolute;top:-1000px;width:100px;height:100px; overflow:hidden;";
    noScroll = document.body.appendChild(oDiv).clientWidth;
    oDiv.style.overflowY = "scroll";
    scroll = oDiv.clientWidth;
    document.body.removeChild(oDiv);
    return noScroll - scroll;
  }

  function getAvaliableH() {
    var avaH = $('body').height()
    return (avaH - 75)
  }
  var avaliableH = getAvaliableH();
  // 日期选择
  $(function () {

    /*// 获取当前时间
    var d = new Date();
    var str = d.getFullYear() + "-" + ((d.getMonth() + 1) < 10 ? "0" : "") + (d.getMonth() + 1) + "-" + (d.getDate() < 10 ? "0" : "") + d.getDate();
    var $date = $('#date');
    //初始化日期搜索jedate
    jeDate('#supply_start_date', {
      onClose: false,
      format: 'YYYY-MM-DD',
      isinitVal: true,
      initDate: [{MM: "-1"}, true], //初始化日期减1个月
      minDate: '2014-06-01', //设定最小日期为当前日期
      maxDate: str //最大日期
    });*/

    var start = {}, end = {};
    jeDate('#supply_start_date',{
      format: 'YYYY-MM-DD',
      minDate: '2014-06-16 23:59:59', //设定最小日期为当前日期
      maxDate: function (that) {
        //that 指向实例对象
        return jeDate.valText(that.valCell) == "" ? jeDate.nowDate({DD:0}) : start.maxDate;
      }, //设定最大日期为当前日期
      donefun: function(obj){
        end.minDate = obj.val; //开始日选好后，重置结束日的最小日期
        jeDate("#supply_end_date",LinkageEndDate(false));
      }
    });
    jeDate('#supply_end_date',LinkageEndDate);
    function LinkageEndDate(istg) {
      return {
        trigger : istg || "click",
        format: 'YYYY-MM-DD',
        minDate: function (that) {
          //that 指向实例对象
          var nowMinDate = jeDate.valText('#supply_start_date') == "" && jeDate.valText(that.valCell) == "";
          return nowMinDate ? jeDate.nowDate({DD:0}) : end.minDate ;
        }, //设定最小日期为当前日期
        maxDate: '2099-06-16 23:59:59', //设定最大日期为当前日期
        donefun: function(obj){
          start.maxDate = obj.val; //将结束日的初始值设定为开始日的最大日期
        }
      };
    }

    jeDate('#settle_date',{
      format: 'YYYY-MM',
      minDate: '2014-06-16 23:59:59', //设定最小日期为当前日期
      donefun: function(obj){

      }
    });

  })

  $(function () {

    /*食材名称列表tab */
    $('.tabs').respTabs({
      responsive: false
    });

    // 初始化食材编辑表格
    var source = [];  //  每一行  输入框名称跟值的映射
    function resetTabullet() {
      $("#table").tabullet({
        data: source,
        action: function (mode, data) {
          // console.dir(data);
          if (mode === 'save') {
            // 循环对比新增的数据中name字段是否已经在表格数据中存在了，如果存在，则验证不通过
            for (var i = 0; i < source.length; i++) {
              if (source[i].name === data.name) {
                layer.alert('菜单中已经有' + data.name);
                return;
              }
            }
            ;
            // 表格数据数组中插入新增出来的数据对象，格式如：{name: "胶瓜（水笋）", unit: "千克（kg）", amount: "38", mark: ""}
            source.push(data);
          }
          if (mode === 'edit') {
            /**
             for (var i = 0; i < source.length; i++) {
	                      if (source[i].id == data.id) {   // undefined==undefined  都是undenfined时也为真
	                          source[i] = data;
	                      }
	                  }*/
            source[data.id - 1] = data;

          }
          if (mode == 'delete') {
            for (var i = 0; i < source.length; i++) {
              /**
               if (source[i].id == data) {
	                          source.splice(i, 1);
	                          break;
	                      }*/
              source.splice(data - 1, 1);
              break;
            }
          }
          resetTabullet();
          $table.find('tbody').height(avaliableH*0.62 - $listPanel.children('.panel-header').height() - $table.children('thead').height() - 17);
        }
      });
    }
    resetTabullet();

    // 设置高度
    var $table = $('#table');
    var $foodPanel = $('#foodPanel');
    var $listPanel = $('#listPanel');
    $foodPanel.height(avaliableH*0.62);
    $listPanel.height(avaliableH*0.62);
    $table.find('tbody').height(avaliableH*0.62 - $listPanel.children('.panel-header').height() - $table.children('thead').height() - 17);


    // 食材名称选择
    !function () {

      // 设置值
      function getVal(event) {
        var $editTr = $("[data-tabullet-id='-1']");
        $editTr.find('input').eq(0).val($(this).text());
        $editTr.find('input').eq(1).val($(this).attr('data-unit') || '斤');
        $editTr.attr('data-id',$(this).attr('data-id'))
      }

      // 设置值并创建行
      function getValAdd(event) {
        var $editTr = $("[data-tabullet-id='-1']");
        $editTr.find('input').eq(0).val($(this).text());
        $editTr.find('input').eq(1).val($(this).attr('data-unit') || '斤');
        $editTr.attr('data-id',$(this).attr('data-id'))
        $editTr.children('td[data-tabullet-type="save"]').children('button').trigger('click');
      }

      // 食材名称单击赋值
      $('.fname').attr('onselectstart', 'return false').on('click', getVal);

      // 食材名双击赋值并新增行
      $('.fname').on('dblclick', getValAdd);

    }();
  });
</script>
</body>
</html>
